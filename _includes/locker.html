{% assign enabled = false %}
{% if page.lock %}
{% assign enabled = true %}
{% endif %}

{% if enabled %}
<div class="lock-card">
    <h2>ğŸ”’ Password Required</h2>
    <form id="gate-{{ page.url | slugify }}">
        <input type="password" id="pw-{{ page.url | slugify }}" placeholder="Enter password" required>
        <button type="submit">Unlock</button>
        <span class="lock-msg" style="margin-left:.5rem;color:#c00;"></span>
    </form>
    <div id="slot-{{ page.url | slugify }}" style="display:none;"></div>
    <template id="tpl-{{ page.url | slugify }}">
        <div id="story-content">
            {{ content }}
        </div>
    </template>
</div>
<script>
    (function () {
        // â˜… Demo å¯†ç¢¼ï¼ˆå¯æ”¹æˆè®€å– window.LOCK_PW æˆ– site.data ä¹‹é¡ï¼›ä»æ˜¯å‰ç«¯ï¼ï¼‰
        const PLAIN_PASSWORD = "{{ page.password | default: '1020' }}";

        const id = "{{ page.url | slugify }}";
        const form = document.getElementById("gate-" + id);
        const input = document.getElementById("pw-" + id);
        const slot = document.getElementById("slot-" + id);
        const tpl = document.getElementById("tpl-" + id);
        const msg = form.querySelector(".lock-msg");

        form.addEventListener("submit", function (e) {
            e.preventDefault();
            if (input.value === PLAIN_PASSWORD) {
                slot.innerHTML = "";
                slot.appendChild(tpl.content.cloneNode(true));
                slot.style.display = "block";
                form.style.display = "none";
            } else {
                msg.textContent = "Wrong password";
                input.select();
            }
        });

        // å°é˜²çˆ¬ï¼šé¿å…è¢«ç´¢å¼•
        var m = document.querySelector('meta[name="robots"]');
        if (!m) {
            m = document.createElement('meta');
            m.name = 'robots';
            m.content = 'noindex,nofollow';
            document.head.appendChild(m);
        }
    })();
</script>
<style>
    .lock-card {
        border: 1px solid #ddd;
        border-radius: 12px;
        padding: 1rem
    }

    .lock-card input,
    .lock-card button {
        font: inherit;
        padding: .5rem .75rem
    }
</style>
{% else %}
<div id="story-content">
    {{ content }}
</div>
{% endif %}